<!DOCTYPE html>  <html> <head>   <title>slider.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               slider.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><a href="http://demo.greweb.fr/slider">Slider.js</a> by @greweb </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>!</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Copyright</span> <span class="mi">2011</span> <span class="nx">Gaetan</span> <span class="nx">Renaudeau</span>

<span class="nx">Licensed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">Apache</span> <span class="nx">License</span><span class="p">,</span> <span class="nx">Version</span> <span class="mf">2.0</span> <span class="p">(</span><span class="nx">the</span> <span class="s2">&quot;License&quot;</span><span class="p">);</span>
<span class="nx">you</span> <span class="nx">may</span> <span class="o">not</span> <span class="nx">use</span> <span class="k">this</span> <span class="nx">file</span> <span class="nx">except</span> <span class="k">in</span> <span class="nx">compliance</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">.</span>
<span class="nx">You</span> <span class="nx">may</span> <span class="nx">obtain</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">License</span> <span class="nx">at</span>

<span class="nx">http</span><span class="o">:</span><span class="err">//www.apache.org/licenses/LICENSE-2.0</span>

<span class="nx">Unless</span> <span class="nx">required</span> <span class="k">by</span> <span class="nx">applicable</span> <span class="nx">law</span> <span class="o">or</span> <span class="nx">agreed</span> <span class="nx">to</span> <span class="k">in</span> <span class="nx">writing</span><span class="p">,</span> <span class="nx">software</span>
<span class="nx">distributed</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">License</span> <span class="o">is</span> <span class="nx">distributed</span> <span class="kc">on</span> <span class="nx">an</span> <span class="s2">&quot;AS IS&quot;</span> <span class="nx">BASIS</span><span class="p">,</span>
<span class="nx">WITHOUT</span> <span class="nx">WARRANTIES</span> <span class="nx">OR</span> <span class="nx">CONDITIONS</span> <span class="nx">OF</span> <span class="nx">ANY</span> <span class="nx">KIND</span><span class="p">,</span> <span class="nx">either</span> <span class="nx">express</span> <span class="o">or</span> <span class="nx">implied</span><span class="p">.</span>
<span class="nx">See</span> <span class="nx">the</span> <span class="nx">License</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specific</span> <span class="nx">language</span> <span class="nx">governing</span> <span class="nx">permissions</span> <span class="o">and</span>
<span class="nx">limitations</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Util function : modulo for negative values</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">mod = </span><span class="nf">(X,Y) -&gt;</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Y</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">X</span><span class="err">/Y)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>RequestAnimationFrame polyfill : https://gist.github.com/997619</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">requestAnimationFrame = </span><span class="o">`</span><span class="nx">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">while</span><span class="p">(</span><span class="nx">a</span><span class="o">--&amp;&amp;!</span><span class="p">(</span><span class="nx">b</span><span class="o">=</span><span class="nb">window</span><span class="p">[</span><span class="s2">&quot;oR0msR0mozR0webkitR0r&quot;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="nx">a</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;equestAnimationFrame&quot;</span><span class="p">]));</span><span class="k">return</span> <span class="nx">b</span><span class="o">||</span><span class="nx">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="mi">15</span><span class="p">)}}(</span><span class="mi">5</span><span class="p">)</span><span class="o">`</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>return the current millisecond timestamp</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">currentTime = </span><span class="o">`</span><span class="nx">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()}</span><span class="o">`</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Slider template</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">tmplSlider = </span><span class="nf">(o) -&gt;</span>
  <span class="nv">slider = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  &lt;div class=&quot;</span><span class="nx">slider</span><span class="s2">&quot;&gt;</span>
<span class="s2">    &lt;div class=&quot;</span><span class="nx">loader</span><span class="s2">&quot;&gt;&lt;span class=&quot;</span><span class="nx">spinner</span><span class="s2">&quot;&gt;&lt;/span&gt; Loading photos... (&lt;span class=&quot;</span><span class="nx">percent</span><span class="s2">&quot;&gt;0&lt;/span&gt;%)&lt;/div&gt;</span>
<span class="s2">    &lt;div class=&quot;</span><span class="nx">slide</span><span class="o">-</span><span class="nx">images</span><span class="s2">&quot;&gt;&lt;/div&gt;</span>
<span class="s2">    &lt;div class=&quot;</span><span class="nx">options</span><span class="s2">&quot;&gt;</span>
<span class="s2">      &lt;a class=&quot;</span><span class="nx">prevSlide</span><span class="s2">&quot; href=&quot;</span><span class="nx">javascript</span><span class="o">:</span><span class="p">;</span><span class="s2">&quot;&gt;prev&lt;/a&gt;</span>
<span class="s2">      &lt;span class=&quot;</span><span class="nx">slide</span><span class="o">-</span><span class="nx">pager</span><span class="s2">&quot;&gt;&lt;/span&gt;</span>
<span class="s2">      &lt;a class=&quot;</span><span class="nx">nextSlide</span><span class="s2">&quot; href=&quot;</span><span class="nx">javascript</span><span class="o">:</span><span class="p">;</span><span class="s2">&quot;&gt;next&lt;/a&gt;</span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">  &lt;/div&gt;</span>
<span class="s2">  &quot;&quot;&quot;</span><span class="p">)</span>
  <span class="nx">slider</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.slide-images&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">slides</span><span class="p">,</span> <span class="nf">(slide) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;slide-image&quot;&gt;&#39;</span><span class="o">+</span>
      <span class="p">(</span><span class="k">if</span> <span class="nx">slide</span><span class="p">.</span><span class="nx">link</span> <span class="k">then</span> <span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="o">+</span><span class="nx">slide</span><span class="p">.</span><span class="nx">link</span><span class="o">+</span><span class="s1">&#39;&quot; target=&quot;_blank&quot;&gt;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span>
      <span class="s1">&#39;&lt;img src=&quot;&#39;</span><span class="o">+</span><span class="nx">slide</span><span class="p">.</span><span class="nx">src</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="o">+</span>
      <span class="p">(</span><span class="k">if</span> <span class="nx">slide</span><span class="p">.</span><span class="nx">name</span> <span class="k">then</span> <span class="s1">&#39;&lt;span class=&quot;caption&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">slide</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;&lt;/span&gt;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span>
      <span class="p">(</span><span class="k">if</span> <span class="nx">slide</span><span class="p">.</span><span class="nx">link</span> <span class="k">then</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span>
      <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="nx">slider</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.slide-pager&#39;</span><span class="p">).</span><span class="nx">append</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">slides</span><span class="p">,</span> <span class="nf">(slide, i) -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;javascript:;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="p">)</span>
  <span class="nx">slider</span>

<span class="nv">tmplSliderWithCanvas = </span><span class="nf">(o) -&gt;</span>
  <span class="nv">node = </span><span class="nx">tmplSlider</span> <span class="nx">o</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.slide-images&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;canvas class=&quot;slide-images&quot; /&gt;&#39;</span><span class="p">)</span>
  <span class="nx">node</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>SliderUtils</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">SliderUtils = </span>
  <span class="nv">extractImageData: </span><span class="nf">(self, from, to) -&gt;</span>
    <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">}</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">clean</span><span class="p">()</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">self</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">from</span><span class="p">]</span>
    <span class="nv">fromData = </span><span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">clean</span><span class="p">()</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">self</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">to</span><span class="p">]</span>
    <span class="nv">toData = </span><span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>
    <span class="nv">output = </span><span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">createImageData</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>
    <span class="k">return</span> <span class="nv">fromData: </span><span class="nx">fromData</span><span class="p">,</span> <span class="nv">toData: </span><span class="nx">toData</span><span class="p">,</span> <span class="nv">output: </span><span class="nx">output</span>
    
  <span class="nv">clippedTransition: </span><span class="nf">( clipFunction ) -&gt;</span> 
    <span class="nf">(self, from, to, progress) -&gt;</span>
      <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">}</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">ctx = </span><span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">self</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">from</span><span class="p">]</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="nx">clipFunction</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">progress</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">clip</span><span class="p">()</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">self</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="nx">to</span><span class="p">]</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>SliderTransitionFunctions</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">SliderTransitionFunctions =</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>A clock load effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clock: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">w</span><span class="err">/2, h/2</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span><span class="err">/2, h/2, Math.max(w, h), 0, Math.PI*2*p, false</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>A circle open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">circle: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">w</span><span class="err">/2, h/2, 0.6*p*Math.max(w, h), 0, Math.PI*2, false</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>A horizontal open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">diamond: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nx">w2</span><span class="o">=</span><span class="nx">w</span><span class="err">/2</span>
      <span class="nx">h2</span><span class="o">=</span><span class="nx">h</span><span class="err">/2</span>
      <span class="nx">dh</span><span class="o">=</span><span class="nx">p</span><span class="o">*</span><span class="nx">h</span>
      <span class="nx">dw</span><span class="o">=</span><span class="nx">p</span><span class="o">*</span><span class="nx">w</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">w2</span><span class="p">,</span>    <span class="nx">h2</span><span class="o">-</span><span class="nx">dh</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w2</span><span class="o">+</span><span class="nx">dw</span><span class="p">,</span> <span class="nx">h2</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w2</span><span class="p">,</span>    <span class="nx">h2</span><span class="o">+</span><span class="nx">dh</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span> <span class="nx">w2</span><span class="o">-</span><span class="nx">dw</span><span class="p">,</span> <span class="nx">h2</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>A vertical open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">verticalOpen: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nx">nbSpike</span><span class="o">=</span><span class="mi">8</span>
      <span class="nx">spikeh</span><span class="o">=</span><span class="nx">h</span><span class="err">/(2*nbSpike) # the height of a demi-spike (triangle)</span>
      <span class="nx">spikew</span><span class="o">=</span><span class="nx">spikeh</span>
      <span class="nx">pw</span><span class="o">=</span><span class="mi">50</span><span class="c1">#todo</span>
      <span class="nx">xl</span><span class="o">=</span><span class="nx">w</span><span class="err">/2-pw</span>
      <span class="nx">xr</span><span class="o">=</span><span class="nx">w</span><span class="err">/2+pw</span>
      <span class="nx">spikel</span><span class="o">=</span><span class="nx">xl</span><span class="o">-</span><span class="nx">spikew</span>
      <span class="nx">spiker</span><span class="o">=</span><span class="nx">xr</span><span class="o">+</span><span class="nx">spikew</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">xl</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>for hi in [0..nbSpike]</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span><span class="o">*</span><span class="nx">w</span><span class="err">/2, 0, w*p, h</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>A horizontal open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">horizontalOpen: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span><span class="o">*</span><span class="nx">h</span><span class="err">/2, w, h*p</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>A sundblind open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">horizontalSunblind: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nv">p = </span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span> <span class="c1">#non linear progress</span>
      <span class="nv">blinds = </span><span class="mi">6</span>
      <span class="nv">blindHeight = </span><span class="nx">h</span><span class="err">/blinds</span>
      <span class="k">for</span> <span class="nx">blind</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">blinds</span><span class="p">]</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">blindHeight</span><span class="o">*</span><span class="nx">blind</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">blindHeight</span><span class="o">*</span><span class="nx">p</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>A vertical sundblind open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">verticalSunblind: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nv">p = </span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span>
      <span class="nv">blinds = </span><span class="mi">10</span>
      <span class="nv">blindWidth = </span><span class="nx">w</span><span class="err">/blinds</span>
      <span class="k">for</span> <span class="nx">blind</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">blinds</span><span class="p">]</span>
        <span class="nv">prog = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="nx">p</span><span class="o">-</span><span class="p">(</span><span class="nx">blind</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nx">blinds</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span> <span class="nx">blindWidth</span><span class="o">*</span><span class="nx">blind</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">blindWidth</span><span class="o">*</span><span class="nx">prog</span><span class="p">,</span> <span class="nx">h</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>circles open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">circles: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nv">circlesY = </span><span class="mi">6</span>
      <span class="nv">circlesX = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">circlesY</span><span class="o">*</span><span class="nx">w</span><span class="err">/h</span>
      <span class="nv">circleW = </span><span class="nx">w</span><span class="err">/circlesX</span>
      <span class="nv">circleH = </span><span class="nx">h</span><span class="err">/circlesY</span>
      <span class="nv">maxWH = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
      <span class="nv">maxRad = </span><span class="mf">0.7</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">circleW</span><span class="p">,</span> <span class="nx">circleH</span><span class="p">)</span>
      <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">circlesX</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">circlesY</span><span class="p">]</span>
          <span class="nv">cx = </span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="nx">circleW</span>
          <span class="nv">cy = </span><span class="p">(</span><span class="nx">y</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="nx">circleH</span>
          <span class="nv">r = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nx">p</span><span class="o">-</span><span class="nx">cx</span><span class="err">/w, 1)) * maxRad</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span> <span class="nx">cx</span><span class="p">,</span> <span class="nx">cy</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span> <span class="nx">cx</span><span class="p">,</span> <span class="nx">cy</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>A square sundblind open effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">squares: </span>
    <span class="nv">render: </span><span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">clippedTransition</span> <span class="nf">(ctx, w, h, p) -&gt;</span>
      <span class="nv">p = </span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">p</span><span class="p">)</span> <span class="c1">#non linear progress</span>
      <span class="nv">blindsY = </span><span class="mi">5</span>
      <span class="nv">blindsX = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">blindsY</span><span class="o">*</span><span class="nx">w</span><span class="err">/h</span>
      <span class="nv">blindWidth = </span><span class="nx">w</span><span class="err">/blindsX</span>
      <span class="nv">blindHeight = </span><span class="nx">h</span><span class="err">/blindsY</span>
      <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">blindsX</span><span class="p">]</span>
        <span class="k">for</span> <span class="nx">y</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">blindsY</span><span class="p">]</span>
          <span class="nv">sx = </span><span class="nx">blindWidth</span><span class="o">*</span><span class="nx">x</span>
          <span class="nv">sy = </span><span class="nx">blindHeight</span><span class="o">*</span><span class="nx">y</span>
          <span class="nv">prog = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nx">p</span><span class="o">-</span><span class="nx">sx</span><span class="err">/w-sy/h, 1))</span>
          <span class="nv">rw = </span><span class="nx">blindWidth</span><span class="o">*</span><span class="nx">prog</span>
          <span class="nv">rh = </span><span class="nx">blindHeight</span><span class="o">*</span><span class="nx">prog</span>
          <span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span> <span class="nx">sx</span><span class="o">-</span><span class="nx">rw</span><span class="err">/2, sy-rh/2, rw, rh</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>A blured fade left effect</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fadeLeft: </span>
    <span class="nv">init: </span><span class="nf">(self, from, to) -&gt;</span> <span class="nx">SliderUtils</span><span class="p">.</span><span class="nx">extractImageData</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span>

    <span class="nv">render: </span><span class="nf">(self, from, to, progress, data) -&gt;</span>
      <span class="nv">blur = </span><span class="mi">150</span>
      <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">}</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">ctx = </span><span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span>
      <span class="nv">fd = </span><span class="nx">data</span><span class="p">.</span><span class="nx">fromData</span><span class="p">.</span><span class="nx">data</span>
      <span class="nv">td = </span><span class="nx">data</span><span class="p">.</span><span class="nx">toData</span><span class="p">.</span><span class="nx">data</span>
      <span class="nv">out = </span><span class="nx">data</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">data</span>
      
      <span class="o">`</span><span class="p">(</span><span class="nx">function</span><span class="p">(){</span>
       <span class="k">for</span> <span class="p">(</span><span class="nx">var</span> <span class="nv">x = </span><span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="nv">p1 = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="nx">width</span><span class="o">*</span><span class="nx">progress</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nx">blur</span><span class="p">)</span><span class="o">/</span><span class="nx">blur</span>
         <span class="nv">p2 = </span><span class="mi">1</span><span class="o">-</span><span class="nx">p1</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">var</span> <span class="nv">y = </span><span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">var</span> <span class="nv">b = </span><span class="p">(</span><span class="nx">y</span><span class="o">*</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span>
         <span class="k">for</span> <span class="p">(</span><span class="nx">var</span> <span class="nv">c = </span><span class="mi">0</span><span class="p">;</span> <span class="nx">c</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">c</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">var</span> <span class="nv">i = </span><span class="nx">b</span> <span class="o">+</span> <span class="nx">c</span><span class="p">;</span>
           <span class="nx">out</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">p1</span> <span class="o">*</span> <span class="p">(</span><span class="nx">fd</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="nx">p2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">td</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">)</span>
         <span class="p">}</span>
         <span class="nx">out</span><span class="p">[</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
       <span class="p">}</span>
     <span class="p">}</span>
      <span class="p">}())</span><span class="o">`</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">putImageData</span> <span class="nx">data</span><span class="p">.</span><span class="nx">output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h2>Slider - a lightweight slider</h2>

<p>Constructor : init container node and current slide number</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Slider</span>
  <span class="nv">constructor: </span><span class="nf">(container) -&gt;</span> <span class="vi">@container = </span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
  <span class="nv">current: </span><span class="mi">0</span>
  <span class="nv">lastHumanNav: </span><span class="mi">0</span>
  <span class="nv">duration: </span><span class="mi">4000</span>
  <span class="nv">w: </span><span class="s1">&#39;640px&#39;</span>
  <span class="nv">h: </span><span class="s1">&#39;430px&#39;</span>
  <span class="nv">theme: </span><span class="s1">&#39;theme-dark&#39;</span>

  <span class="nv">tmpl: </span><span class="nx">tmplSlider</span>
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Util function : return the circular value of num</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">circular: </span><span class="nf">(num) -&gt;</span> <span class="nx">mod</span> <span class="nx">num</span><span class="p">,</span> <span class="nx">@slides</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Go to slide number <code>num</code> : update both DOM and this.current</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">slide: </span><span class="nf">(num = 0) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>num must be between 0 and nbslides-1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">num = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">@slides</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">@slides</span> <span class="o">&amp;&amp;</span> <span class="nx">@pages</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Move current class in <strong>slides</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@slides</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">@current</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s2">&quot;current&quot;</span>
      <span class="nx">@slides</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">addClass</span> <span class="s2">&quot;current&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Move current class in <strong>pages</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@pages</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">@current</span><span class="p">).</span><span class="nx">removeClass</span> <span class="s2">&quot;current&quot;</span>
      <span class="nx">@pages</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">num</span><span class="p">).</span><span class="nx">addClass</span> <span class="s2">&quot;current&quot;</span>
    <span class="vi">@current = </span><span class="nx">num</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Go to circular next slide (will call <code>slide</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">next: </span><span class="o">-&gt;</span> <span class="nx">@slide</span> <span class="nx">@circular</span><span class="p">(</span><span class="nx">@current</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Go to circular previous slide (will call <code>slide</code>)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">prev: </span><span class="o">-&gt;</span> <span class="nx">@slide</span> <span class="nx">@circular</span><span class="p">(</span><span class="nx">@current</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Change the duration between each slide</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setDuration: </span><span class="nf">(@duration) -&gt;</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Change the slider transition CSS class</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setTransition: </span><span class="nf">(transition) -&gt;</span>
    <span class="k">if</span> <span class="nx">@node</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">@transition</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@transition</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">transition</span><span class="p">)</span> <span class="k">if</span> <span class="nx">transition</span>
    <span class="vi">@transition = </span><span class="nx">transition</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Change the slider theme CSS class</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setTheme: </span><span class="nf">(theme = &quot;theme-dark&quot;) -&gt;</span>
    <span class="k">if</span> <span class="nx">@node</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">@theme</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@theme</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">theme</span><span class="p">)</span> <span class="k">if</span> <span class="nx">theme</span>
    <span class="vi">@theme = </span><span class="nx">theme</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>set slider size</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setSize: </span><span class="nf">(@w, @h) -&gt;</span>
    <span class="k">if</span> <span class="nx">@node</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">width</span> <span class="nx">w</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slide-image&quot;</span><span class="p">).</span><span class="nx">width</span> <span class="nx">w</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slide-images&quot;</span><span class="p">).</span><span class="nx">height</span> <span class="nx">h</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Fetch photos with a JSON providing its <code>url</code>.
If <code>options</code> is defined, passing it in request params.
If <code>transformer</code> is defined, using it to transform the json
to a compatible json to pass to <code>Slider.setPhotos</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">fetchJson: </span><span class="nf">(url, options, transformer) -&gt;</span>
    <span class="nv">params = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">options</span><span class="p">)</span>
    <span class="nx">transformer</span> <span class="o">?=</span> <span class="nf">(json) -&gt;</span> <span class="nx">json</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">@setPhotos</span> <span class="nx">transformer</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Sync slider data to DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_sync: </span><span class="o">-&gt;</span>
    <span class="nx">@setTransition</span> <span class="nx">@transition</span>
    <span class="nx">@setTheme</span> <span class="nx">@theme</span>
    <span class="nx">@setSize</span> <span class="nx">@w</span><span class="p">,</span> <span class="nx">@h</span>
    <span class="nx">@slide</span> <span class="nx">@current</span> <span class="k">if</span> <span class="nx">@slides</span>
  </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><code>slides</code> : format: array of { src, name, link (optional) } </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setPhotos: </span><span class="nf">(@photos) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Templating and appending to DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@node = </span><span class="nx">@tmpl</span><span class="p">(</span><span class="nv">slides: </span><span class="nx">photos</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;loading&quot;</span><span class="p">)</span>
    <span class="nx">@container</span><span class="p">.</span><span class="nx">empty</span><span class="p">().</span><span class="nx">append</span> <span class="nx">@node</span>
    <span class="vi">@current = </span><span class="mi">0</span>
    <span class="nx">@_sync</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Loading all images before showing the slider</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">nbLoad = </span><span class="mi">0</span>
    <span class="nv">imgs = </span><span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slide-image img&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nv">total = </span><span class="nx">imgs</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span>
      <span class="k">if</span> <span class="o">++</span><span class="nx">nbLoad</span> <span class="o">==</span> <span class="nx">total</span>
        <span class="nx">@node</span><span class="p">.</span><span class="nx">removeClass</span> <span class="s2">&quot;loading&quot;</span>
        <span class="nx">@start</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Update loader progression (in percent)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.loader .percent&quot;</span><span class="p">).</span><span class="nx">text</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">nbLoad</span> <span class="err">/ total)</span>
    <span class="p">)</span>
    <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.loader&quot;</span><span class="p">).</span><span class="nx">text</span> <span class="s2">&quot;No photo&quot;</span>  <span class="k">if</span> <span class="nx">imgs</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">this</span>
  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Start the slider</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">start: </span><span class="o">-&gt;</span>
    <span class="vi">@slides = </span><span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slide-image&quot;</span><span class="p">)</span>
    <span class="vi">@pages = </span><span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slide-pager a&quot;</span><span class="p">)</span>
    <span class="nx">@_sync</span><span class="p">()</span>
    <span class="nx">@_bind</span><span class="p">()</span>
    <span class="k">this</span>

  <span class="nv">stop: </span><span class="o">-&gt;</span>
    <span class="nx">@_unbind</span><span class="p">()</span>
    <span class="k">this</span>
  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Bind slider DOM events for navigation</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_bind: </span><span class="o">-&gt;</span>
    <span class="nx">@_unbind</span><span class="p">()</span>
    <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.prevSlide&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span> <span class="nx">@prev</span><span class="p">()</span>
    <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.nextSlide&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span> <span class="nx">@next</span><span class="p">()</span>
    <span class="nv">self = </span><span class="k">this</span>
    <span class="k">if</span> <span class="nx">@node</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.slide-pager a&quot;</span><span class="p">).</span><span class="nx">each</span> <span class="nf">(i) -&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">click</span> <span class="o">-&gt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">slide</span> <span class="nx">i</span>
      <span class="nv">now = </span><span class="o">-&gt;</span> <span class="nx">currentTime</span><span class="p">()</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.options a&quot;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span> <span class="vi">@lastHumanNav = </span><span class="nx">now</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@timeout</span>
      <span class="nv">loop_ = </span><span class="o">=&gt;</span>
        <span class="nx">@next</span><span class="p">()</span> <span class="k">if</span> <span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@lastHumanNav</span> <span class="o">&gt;</span> <span class="mi">2000</span>
        <span class="vi">@timeout = </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">loop_</span><span class="p">,</span> <span class="nx">@duration</span><span class="p">)</span>
      <span class="vi">@timeout = </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">loop_</span><span class="p">,</span> <span class="nx">@duration</span><span class="p">)</span>
    <span class="k">this</span>

  <span class="nv">_unbind: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@node</span>
      <span class="nx">@node</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.prevSlide, .nextSlide, .slide-pager a, .options a&quot;</span><span class="p">).</span><span class="nx">unbind</span> <span class="s1">&#39;click&#39;</span> 
    <span class="k">if</span> <span class="nx">@timeout</span>
      <span class="nx">clearTimeout</span> <span class="nx">@timeout</span>
      <span class="vi">@timeout = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h2>SliderWithCanvas</h2>

<p>Let's support canvas transitions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">SliderWithCanvas</span> <span class="k">extends</span> <span class="nx">Slider</span>
  <span class="nv">transitionFunction: </span><span class="nx">SliderTransitionFunctions</span><span class="p">.</span><span class="nx">clock</span>
  <span class="nv">transitionDuration: </span><span class="mi">1000</span>
  <span class="nv">tmpl: </span><span class="nx">tmplSliderWithCanvas</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>also synchronize the renderMode</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_sync: </span><span class="nf">() -&gt;</span>
    <span class="nv">renderMode = </span><span class="nx">@renderMode</span>
    <span class="k">super</span>
    <span class="nx">@setRenderMode</span><span class="p">(</span><span class="nx">renderMode</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Init some variables related to canvas</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">start: </span><span class="nf">() -&gt;</span>
    <span class="vi">@notCanvas = </span><span class="nx">@node</span><span class="p">.</span><span class="nx">find</span> <span class="s1">&#39;.slide-images:not(canvas) img&#39;</span>
    <span class="vi">@canvas = </span><span class="nx">@node</span><span class="p">.</span><span class="nx">find</span> <span class="s1">&#39;canvas.slide-images&#39;</span>
    <span class="vi">@ctx = </span><span class="nx">@canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">getContext</span> <span class="s1">&#39;2d&#39;</span>
    <span class="vi">@images = </span><span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">@photos</span><span class="p">,</span> <span class="p">((</span><span class="nx">photo</span><span class="p">)</span> <span class="o">=&gt;</span> 
      <span class="nv">img = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
      <span class="nv">img.src = </span><span class="nx">photo</span><span class="p">.</span><span class="nx">src</span>
      <span class="nx">img</span>
    <span class="p">))</span> <span class="k">if</span> <span class="nx">@photos</span>
    <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>The <code>setSize</code> method should update the canvas size</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setSize: </span><span class="nf">(w, h) -&gt;</span>
    <span class="k">super</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span>
    <span class="nx">@canvas</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="nx">h</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@canvas</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>set the render mode of the slider ( canvas | css )</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setRenderMode: </span><span class="nf">(@renderMode) -&gt;</span>
    <span class="k">if</span> <span class="nx">@ctx</span>
      <span class="k">if</span> <span class="nx">@renderMode</span> <span class="o">is</span> <span class="s1">&#39;canvas&#39;</span>
        <span class="nx">@drawImage</span> <span class="nx">@images</span><span class="p">[</span><span class="nx">@current</span><span class="p">]</span>
        <span class="nx">@notCanvas</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">@canvas</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@canvas</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">@notCanvas</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
    <span class="k">this</span>

  <span class="nv">setTransition: </span><span class="nf">(transition) -&gt;</span> 
    <span class="nx">@setRenderMode</span> <span class="s1">&#39;css&#39;</span>
    <span class="k">super</span> <span class="nx">transition</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Change the slider transition function (for the canvas animation)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setTransitionFunction: </span><span class="nf">(@transitionFunction) -&gt;</span> 
    <span class="nx">@setRenderMode</span> <span class="s1">&#39;canvas&#39;</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Change the slider transition duration (means the time of the transition)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setTransitionDuration: </span><span class="nf">(@transitionDuration) -&gt;</span>
    <span class="nx">@setRenderMode</span> <span class="s1">&#39;canvas&#39;</span>
    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Overriding <code>slide</code> to support the canvas rendering</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">slide: </span><span class="nf">(num) -&gt;</span>
    <span class="vi">@fromSlide = </span><span class="nx">@current</span>
    <span class="vi">@toSlide = </span><span class="nx">num</span>
    <span class="vi">@transitionStart = </span><span class="nx">currentTime</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">@ctx</span> <span class="o">and</span> <span class="nx">@renderMode</span> <span class="o">is</span> <span class="s1">&#39;canvas&#39;</span>
      <span class="nx">@startRender</span><span class="p">()</span>
    <span class="k">super</span> <span class="nx">num</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>clean the canvas</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clean: </span><span class="o">-&gt;</span> <span class="nx">@ctx</span><span class="p">.</span><span class="nx">clearRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">width</span><span class="p">,</span> <span class="nx">@canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">height</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>draw an image on the all canvas with the correct ratio</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drawImage: </span><span class="nf">(img) -&gt;</span> 
    <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">}</span> <span class="o">=</span> <span class="nx">@canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">@ctx</span><span class="p">.</span><span class="nx">drawImage</span> <span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">width</span><span class="o">*</span><span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="err">/img.width</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p><code>_renderId</code> help to make sure once transition is running</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_renderId: </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>init render loop</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">startRender: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@transitionFunction</span><span class="p">.</span><span class="nx">init</span>
      <span class="vi">@tfdata = </span><span class="nx">@transitionFunction</span><span class="p">.</span><span class="nx">init</span> <span class="k">this</span><span class="p">,</span> <span class="nx">@fromSlide</span><span class="p">,</span> <span class="nx">@toSlide</span>
    <span class="nx">@render</span><span class="p">(</span><span class="o">++</span><span class="nx">@_renderId</span><span class="p">,</span> <span class="nx">@transitionFunction</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>render loop</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">(id, transitionFunction) -&gt;</span>
    <span class="nv">now = </span><span class="nx">currentTime</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">id</span><span class="o">==</span><span class="nx">@_renderId</span> <span class="o">and</span> <span class="nx">now</span> <span class="o">&gt;=</span> <span class="nx">@transitionStart</span>
      <span class="nv">progress = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">now</span> <span class="o">-</span> <span class="nx">@transitionStart</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@transitionDuration</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">progress</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="nx">@clean</span><span class="p">()</span>
        <span class="nx">@drawImage</span> <span class="nx">@images</span><span class="p">[</span><span class="nx">@toSlide</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="nx">transitionFunction</span><span class="p">.</span><span class="nx">render</span> <span class="k">this</span><span class="p">,</span> <span class="nx">@fromSlide</span><span class="p">,</span> <span class="nx">@toSlide</span><span class="p">,</span> <span class="nx">progress</span><span class="p">,</span> <span class="nx">@tfdata</span>
        <span class="nx">requestAnimationFrame</span> <span class="p">(</span><span class="o">=&gt;</span><span class="nx">@render</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">transitionFunction</span><span class="p">)),</span> <span class="nx">@canvas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h2>Exporting global variables</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">Slider = </span><span class="nx">SliderWithCanvas</span>
<span class="nb">window</span><span class="p">.</span><span class="nv">SliderTransitionFunctions = </span><span class="nx">SliderTransitionFunctions</span>
<span class="nb">window</span><span class="p">.</span><span class="nv">SliderUtils = </span><span class="nx">SliderUtils</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 