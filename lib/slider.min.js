/*!
Copyright 2011 Gaetan Renaudeau
http://greweb.fr/slider

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
(function(){var d,f,e,k,a,j,h,i,c,g={}.hasOwnProperty,b=function(o,m){for(var l in m){if(g.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o};j=function(m,l){return m-l*Math.floor(m/l)};h=function(m,l){while(m--&&!(l=window["oR0msR0mozR0webkitR0r".split(0)[m]+"equestAnimationFrame"])){}return l||function(n){setTimeout(n,15)}}(5);a=function(){return new Date().getTime()};i=function(m){var l;l=$('<div class="slider">\n  <div class="loader"><span class="spinner"></span> <span class="percent">0</span>%</div>\n  <div class="slide-images"></div>\n  <div class="options">\n    <a class="prevSlide" href="javascript:;">prev</a>\n    <span class="slide-pager"></span>\n    <a class="nextSlide" href="javascript:;">next</a>\n  </div>\n</div>');l.find(".slide-images").append($.map(m.slides,function(n){return $('<div class="slide-image">'+(n.link?'<a href="'+n.link+'" target="_blank">':"")+'<img src="'+n.src+'">'+(n.name?'<span class="caption">'+n.name+"</span>":"")+(n.link?"</a>":"")+"</div>")[0]}));l.find(".slide-pager").append($.map(m.slides,function(n,o){return $('<a href="javascript:;">'+(o+1)+"</a>")[0]}));return l};c=function(m){var l;l=i(m);l.find("div.slide-images").append('<canvas class="slide-images" />');return l};e={extractImageData:function(t,p,q){var r,s,m,o,l,n;n=t.canvas[0],l=n.width,s=n.height;t.clean();t.drawImage(t.images[p]);r=t.ctx.getImageData(0,0,l,s);t.clean();t.drawImage(t.images[q]);o=t.ctx.getImageData(0,0,l,s);m=t.ctx.createImageData(l,s);return{fromData:r,toData:o,output:m}},clippedTransition:function(l){return function(o,t,s,p){var n,m,q,r;r=o.canvas[0],q=r.width,m=r.height;n=o.ctx;o.drawImage(o.images[t]);n.save();n.beginPath();l(n,q,m,p);n.clip();o.drawImage(o.images[s]);return n.restore()}}};f={clock:{render:e.clippedTransition(function(m,l,n,o){m.moveTo(l/2,n/2);return m.arc(l/2,n/2,Math.max(l,n),0,Math.PI*2*o,false)})},circle:{render:e.clippedTransition(function(m,l,n,o){return m.arc(l/2,n/2,0.6*o*Math.max(l,n),0,Math.PI*2,false)})},diamond:{render:e.clippedTransition(function(n,m,r,t){var s,q,o,l;l=m/2;o=r/2;s=t*r;q=t*m;n.moveTo(l,o-s);n.lineTo(l+q,o);n.lineTo(l,o+s);return n.lineTo(l-q,o)})},verticalOpen:{render:e.clippedTransition(function(C,x,D,A){var u,t,r,B,z,s,q,l,E,y,v,o,m,n;B=8;s=D/(2*B);E=s;z=A*x/2;y=x/2-z;v=x/2+z;q=y-E;l=v+E;C.moveTo(y,0);for(r=o=0;0<=B?o<=B:o>=B;r=0<=B?++o:--o){u=(2*r)*s;t=u+s;C.lineTo(q,u);C.lineTo(y,t)}C.lineTo(l,D);n=[];for(r=m=B;B<=0?m<=0:m>=0;r=B<=0?++m:--m){u=(2*r)*s;t=u-s;C.lineTo(v,u);n.push(C.lineTo(l,t))}return n})},horizontalOpen:{render:e.clippedTransition(function(m,l,n,o){return m.rect(0,(1-o)*n/2,l,n*o)})},horizontalSunblind:{render:e.clippedTransition(function(u,t,q,l){var r,s,o,n,m;l=1-(1-l)*(1-l);o=6;s=q/o;m=[];for(r=n=0;0<=o?n<=o:n>=o;r=0<=o?++n:--n){m.push(u.rect(0,s*r,t,s*l))}return m})},verticalSunblind:{render:e.clippedTransition(function(v,u,r,l){var t,s,o,q,n,m;l=1-(1-l)*(1-l);o=10;s=u/o;m=[];for(t=n=0;0<=o?n<=o:n>=o;t=0<=o?++n:--n){q=Math.max(0,Math.min(2*l-(t+1)/o,1));m.push(v.rect(s*t,0,s*q,r))}return m})},circles:{render:e.clippedTransition(function(G,E,v,m){var u,D,A,z,q,n,t,F,l,C,B,s,o;z=6;A=Math.floor(z*E/v);D=E/A;u=v/z;F=Math.max(E,v);t=0.7*Math.max(D,u);o=[];for(C=s=0;0<=A?s<=A:s>=A;C=0<=A?++s:--s){o.push((function(){var r,p;p=[];for(B=r=0;0<=z?r<=z:r>=z;B=0<=z?++r:--r){q=(C+0.5)*D;n=(B+0.5)*u;l=Math.max(0,Math.min(2*m-q/E,1))*t;G.moveTo(q,n);p.push(G.arc(q,n,l,0,Math.PI*2,false))}return p})())}return o})},squares:{render:e.clippedTransition(function(F,E,t,l){var A,u,o,n,s,D,m,C,z,B,v,r,q;l=1-(1-l)*(1-l);n=5;o=Math.floor(n*E/t);u=E/o;A=t/n;q=[];for(B=r=0;0<=o?r<=o:r>=o;B=0<=o?++r:--r){q.push((function(){var w,p;p=[];for(v=w=0;0<=n?w<=n:w>=n;v=0<=n?++w:--w){C=u*B;z=A*v;s=Math.max(0,Math.min(3*l-C/E-z/t,1));m=u*s;D=A*s;p.push(F.rect(C-m/2,z-D/2,m,D))}return p})())}return q})},fadeLeft:{init:function(l,r,q){var o,m,p,n;o=e.extractImageData(l,r,q);o.randomTrait=[];m=l.canvas[0].height;for(p=n=0;0<=m?n<=m:n>=m;p=0<=m?++n:--n){o.randomTrait[p]=Math.random()}return o},render:function(x,u,v,l,s){var o,y,n,w,q,t,p,m,r;o=150;r=x.canvas[0],m=r.width,w=r.height;y=x.ctx;n=s.fromData.data;p=s.toData.data;q=s.output.data;t=s.randomTrait;(function(){var A=m*l/o;for(var F=0;F<m;++F){var z=F/o;for(var D=0;D<w;++D){var E=(D*m+F)*4;var H=Math.min(Math.max((z-A*(1+t[D]/10)),0),1);var G=1-H;for(var C=0;C<3;++C){var B=E+C;q[B]=H*(n[B])+G*(p[B])}q[E+3]=255}}}());return x.ctx.putImageData(s.output,0,0)}}};d=(function(){function l(m,n){var q,p,o;if(n==null){n={}}this.container=$(m);o=this.defaults;for(q in o){p=o[q];this[q]=q in n?ops[q]:p}this}l.prototype.defaults={current:0,lastHumanNav:0,duration:4000,w:"640px",h:"430px",theme:"theme-dark",tmpl:i};l.prototype.circular=function(m){return j(m,this.slides.size())};l.prototype.slide=function(m){if(this.slides&&this.pages){m=Math.max(0,Math.min(m,this.slides.size()-1));this.slides.eq(this.current).removeClass("current");this.slides.eq(m).addClass("current");this.pages.eq(this.current).removeClass("current");this.pages.eq(m).addClass("current")}this.current=m;return this};l.prototype.next=function(){return this.slide(this.circular(this.current+1))};l.prototype.prev=function(){return this.slide(this.circular(this.current-1))};l.prototype.setDuration=function(m){this.duration=m;return this};l.prototype.setTransition=function(m){if(this.node){if(this.transition){this.node.removeClass(this.transition)}if(m){this.node.addClass(m)}}this.transition=m;return this};l.prototype.setTheme=function(m){if(m==null){m="theme-dark"}if(this.node){if(this.theme){this.node.removeClass(this.theme)}if(m){this.node.addClass(m)}}this.theme=m;return this};l.prototype.setSize=function(m,n){this.w=m;this.h=n;if(this.node){this.node.width(m);this.node.find(".slide-image").width(m);this.node.find(".slide-images").height(n)}return this};l.prototype.fetchJson=function(o,n,m){var p,q=this;p=$.extend({},n);if(m==null){m=function(r){return r}}$.getJSON(o,p,function(r){return q.setPhotos(m(r))});return this};l.prototype._sync=function(){this.setTransition(this.transition);this.setTheme(this.theme);this.setSize(this.w,this.h);return this.slide(this.current)};l.prototype.setPhotos=function(p){var o,m,n=this;this.photos=p;this.node=this.tmpl({slides:p}).addClass("loading");this.container.empty().append(this.node);this._sync();m=0;o=this.node.find(".slide-image img").bind("load",function(){var q;q=o.size();if(++m===q){n.node.removeClass("loading");n.start()}return n.node.find(".loader .percent").text(Math.floor(100*m/q))});if(o.size()===0){this.node.find(".loader").text("No photo")}return this};l.prototype.start=function(){this.slides=this.node.find(".slide-image");this.pages=this.node.find(".slide-pager a");this._sync();this._bind();return this};l.prototype.stop=function(){this._unbind();return this};l.prototype._bind=function(){var p,n,m,o=this;this._unbind();this.node.find(".prevSlide").click(function(){return o.prev()});this.node.find(".nextSlide").click(function(){return o.next()});m=this;if(this.node){this.node.find(".slide-pager a").each(function(q){return $(this).click(function(){return m.slide(q)})});n=function(){return a()};this.node.find(".options a").click(function(){return o.lastHumanNav=n()})}if(!this.timeout){p=function(){if(n()-o.lastHumanNav>2000){o.next()}return o.timeout=setTimeout(p,o.duration)};this.timeout=setTimeout(p,this.duration)}return this};l.prototype._unbind=function(){if(this.node){this.node.find(".prevSlide, .nextSlide, .slide-pager a, .options a").unbind("click")}if(this.timeout){clearTimeout(this.timeout);return this.timeout=null}};return l})();k=(function(m){b(l,m);function l(){return l.__super__.constructor.apply(this,arguments)}l.prototype.transitionFunction=f.clock;l.prototype.transitionDuration=1500;l.prototype.tmpl=c;l.prototype._sync=function(){var n;n=this.renderMode;l.__super__._sync.apply(this,arguments);return this.setRenderMode(n)};l.prototype.start=function(){var n=this;this.notCanvas=this.node.find(".slide-images:not(canvas) img");this.canvas=this.node.find("canvas.slide-images");if(this.canvas[0]&&this.canvas[0].getContext){this.ctx=this.canvas[0].getContext("2d")}if(this.photos){this.images=$.map(this.photos,(function(p){var o;o=new Image();o.src=p.src;return o}))}return l.__super__.start.apply(this,arguments)};l.prototype.setSize=function(n,o){l.__super__.setSize.call(this,n,o);if(this.canvas){this.canvas.attr("height",o).attr("width",n)}return this};l.prototype.setRenderMode=function(n){this.renderMode=n;if(this.ctx){if(this.renderMode==="canvas"){this.drawImage(this.images[this.current]);this.notCanvas.hide();this.canvas.show()}else{this.canvas.hide();this.notCanvas.show()}}return this};l.prototype.setTransition=function(n){this.setRenderMode("css");l.__super__.setTransition.call(this,n);return this};l.prototype.setTransitionFunction=function(n){this.transitionFunction=n;this.setRenderMode("canvas");return this};l.prototype.setTransitionDuration=function(n){this.transitionDuration=n;this.setRenderMode("canvas");return this};l.prototype.slide=function(n){this.fromSlide=this.current;this.toSlide=n;this.transitionStart=a();if(this.ctx&&this.renderMode==="canvas"){this.startRender()}return l.__super__.slide.call(this,n)};l.prototype.clean=function(){return this.ctx.clearRect(0,0,this.canvas[0].width,this.canvas[0].height)};l.prototype.drawImage=function(o){var n,p,q;q=this.canvas[0],p=q.width,n=q.height;return this.ctx.drawImage(o,0,0,p,p*o.height/o.width)};l.prototype._renderId=0;l.prototype.startRender=function(){if(this.transitionFunction.init){this.tfdata=this.transitionFunction.init(this,this.fromSlide,this.toSlide)}return this.render(++this._renderId,this.transitionFunction)};l.prototype.render=function(r,p){var o,n,q=this;o=a();if(r===this._renderId&&o>=this.transitionStart){n=Math.min(1,(o-this.transitionStart)/this.transitionDuration);if(n===1){this.clean();return this.drawImage(this.images[this.toSlide])}else{p.render(this,this.fromSlide,this.toSlide,n,this.tfdata);return h((function(){return q.render(r,p)}),this.canvas[0])}}};return l})(d);window.Slider=k;window.SliderTransitionFunctions=f;window.SliderUtils=e}).call(this);